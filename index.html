<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Notas (peso global por campo)</title>
<style>
  :root{--bg:#0f1220;--card:#171a2a;--muted:#8ea0b5;--txt:#e9eef5;--accent:#7cc5ff}
  *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial}
  body{margin:0;background:#0f1220;color:var(--txt)}
  header{padding:20px;text-align:center}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  .card{background:var(--card);border:1px solid #232844;border-radius:16px;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:10px}
  .day{border:1px dashed #2b3156;border-radius:12px;padding:10px}
  .day h3{margin:0 0 6px;color:var(--accent);font-size:.95rem}
  label{display:block;font-size:.82rem;color:var(--muted);margin:6px 0 2px}
  input[type=number]{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #2b3156;background:#0f1327;color:var(--txt)}
  .weights{font-size:.78rem;color:#a8b6c9;margin-top:6px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:12px}
  button{padding:9px 14px;border-radius:10px;border:1px solid #2b3156;background:#1a2140;color:var(--txt);cursor:pointer;font-weight:600}
  button.primary{background:#2764ff;border-color:#2764ff}
  .pill{background:#152047;border:1px solid #2b3156;padding:4px 8px;border-radius:999px;font-size:.78rem;color:#b9c8db}
  .result{margin-top:14px;padding:14px;border-radius:12px;background:#0f1327;border:1px solid #2b3156}
  .big{font-size:2rem;font-weight:800;color:#b7e4ff}
  .muted{color:#9cb0c7}
  .error{color:#ff9aa8;font-size:.9rem;margin-top:8px;display:none}
</style>
</head>
<body>
<header><h1>Calculadora (10 dias × 2 notas, pesos globais A=0,6 / B=0,4)</h1></header>
<div class="container">
  <div class="card">
    <div id="daysGrid" class="grid"></div>

    <div class="row">
      <button class="primary" id="calcBtn">Calcular</button>
      <button id="clearBtn">Limpar</button>
      <span class="pill" id="pillCampos">Campos preenchidos: 0 / 20 (peso somado: 0.0)</span>
    </div>

    <div class="result">
      <div class="muted">Resultado (0–10)</div>
      <div class="big" id="final">—</div>
      <div class="muted" id="detalhes" style="margin-top:8px"></div>
    </div>

    <div class="error" id="errorBox"></div>
  </div>
</div>

<script>
(function (){
  const DIAS = 10;
  const PESO_A = 0.6; // campo A (por dia)
  const PESO_B = 0.4; // campo B (por dia)

  const grid = document.getElementById('daysGrid');
  const calcBtn = document.getElementById('calcBtn');
  const clearBtn = document.getElementById('clearBtn');
  const finalEl = document.getElementById('final');
  const detalhesEl = document.getElementById('detalhes');
  const pillCampos = document.getElementById('pillCampos');
  const errorBox = document.getElementById('errorBox');

  // Monta inputs
  for (let i = 1; i <= DIAS; i++) {
    const wrap = document.createElement('div');
    wrap.className = 'day';
    wrap.innerHTML = `
      <h3>Dia ${i}</h3>
      <label for="d${i}a">Nota A (peso 0,6)</label>
      <input type="number" step="0.01" min="0" max="10" id="d${i}a" placeholder="0 a 10" />
      <label for="d${i}b">Nota B (peso 0,4)</label>
      <input type="number" step="0.01" min="0" max="10" id="d${i}b" placeholder="0 a 10" />
      <div class="weights" id="w${i}">A=0,6 | B=0,4</div>
    `;
    grid.appendChild(wrap);
  }

  function val(v){
    if (v === '' || v === null || v === undefined) return null;
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function calcular(){
    errorBox.style.display = 'none';
    errorBox.textContent = '';

    let somaPonderada = 0;
    let somaPesos = 0;
    let camposPreenchidos = 0;

    const linhasDetalhe = [];

    for (let i = 1; i <= DIAS; i++) {
      const a = val(document.getElementById(`d${i}a`).value);
      const b = val(document.getElementById(`d${i}b`).value);

      // validação de faixa
      for (const x of [a,b]) {
        if (x !== null && (x < 0 || x > 10)) {
          errorBox.style.display = 'block';
          errorBox.textContent = `Erro no Dia ${i}: notas devem estar entre 0 e 10.`;
          return;
        }
      }

      let linha = `Dia ${i}: `;

      if (a !== null) {
        somaPonderada += a * PESO_A;
        somaPesos += PESO_A;
        camposPreenchidos++;
        linha += `A=${a.toFixed(2)}(w=0.6) `;
      } else {
        linha += `A=—(w=0.6 ignorado) `;
      }

      if (b !== null) {
        somaPonderada += b * PESO_B;
        somaPesos += PESO_B;
        camposPreenchidos++;
        linha += `| B=${b.toFixed(2)}(w=0.4)`;
      } else {
        linha += `| B=—(w=0.4 ignorado)`;
      }

      linhasDetalhe.push(linha);
    }

    pillCampos.textContent = `Campos preenchidos: ${camposPreenchidos} / ${DIAS*2} (peso somado: ${somaPesos.toFixed(1)})`;

    if (somaPesos === 0) {
      finalEl.textContent = '—';
      detalhesEl.innerHTML = 'Preencha pelo menos um campo.';
      return;
    }

    const media = somaPonderada / somaPesos; // 0..10
    finalEl.textContent = media.toFixed(2);

    detalhesEl.innerHTML = `
      <div><b>Soma ponderada:</b> ${somaPonderada.toFixed(2)}</div>
      <div><b>Soma dos pesos (apenas campos preenchidos):</b> ${somaPesos.toFixed(1)}</div>
      <div style="margin-top:6px;font-size:.92rem">${linhasDetalhe.join('<br>')}</div>
      <div style="margin-top:8px;color:#aab9ce;font-size:.85rem">
        Regra: pesos dos campos <i>vazios</i> são removidos do denominador (redistribuição global automática).
      </div>
    `;
  }

  function limpar(){
    for (let i=1;i<=DIAS;i++){
      document.getElementById(`d${i}a`).value = '';
      document.getElementById(`d${i}b`).value = '';
    }
    finalEl.textContent = '—';
    detalhesEl.textContent = '';
    pillCampos.textContent = `Campos preenchidos: 0 / ${DIAS*2} (peso somado: 0.0)`;
    errorBox.style.display = 'none';
    errorBox.textContent = '';
  }

  calcBtn.addEventListener('click', calcular);
  clearBtn.addEventListener('click', limpar);
  grid.addEventListener('input', (e)=>{ if (e.target.matches('input[type=number]')) calcular(); });

  calcular(); // primeira render
})();
</script>
</body>
</html>
